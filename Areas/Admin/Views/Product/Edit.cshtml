@model MyWebApp.Models.Product

@{
    ViewData["Title"] = "Chỉnh sửa sản phẩm";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<link rel = "stylesheet" href = "~/css/Admin/Ckecss.css"/>

<div class = "container mt-5">
    <div class = "card shadow-lg border-0">
        <div class = "card-header bg-warning text-dark">
            <h4 class = "mb-0"><i class = "fas fa-edit me-2"></i>Chỉnh sửa sản phẩm</h4>
        </div>

        <div class = "card-body">
            <form asp-area = "Admin" asp-action = "Edit" asp-controller = "Product" enctype = "multipart/form-data" method = "post">
                <input type = "hidden" asp-for = "Id"/>
                <div asp-validation-summary = "ModelOnly" class = "text-danger mb-2"></div>
                <div class = "row g-4">
                    <div class = "col-md-6">
                        <label asp-for = "Name" class = "form-label">Tên sản phẩm</label>
                        <input asp-for = "Name" class = "form-control"/>
                        <span asp-validation-for = "Name" class = "text-danger"></span>
                    </div>

                    <div class = "col-md-3">
                        <label asp-for = "Price" class = "form-label">Giá</label>
                        <input asp-for = "Price" class = "form-control"/>
                        <span asp-validation-for = "Price" class = "text-danger"></span>
                    </div>

                    <div class = "col-md-3">
                        <label asp-for = "Quantity" class = "form-label">Số lượng</label>
                        <input asp-for = "Quantity" class = "form-control"/>
                        <span asp-validation-for = "Quantity" class = "text-danger"></span>
                    </div>

                    <div class = "col-md-6">
                        <label asp-for = "CategoryId" class = "form-label">Danh mục</label>
                        <select asp-for = "CategoryId" asp-items = "ViewBag.Categories" class = "form-select"></select>
                        <span asp-validation-for = "CategoryId" class = "text-danger"></span>
                    </div>

                    <div class = "col-md-6">
                        <label asp-for = "BrandId" class = "form-label">Thương hiệu</label>
                        <select asp-for = "BrandId" asp-items = "ViewBag.Brands" class = "form-select"></select>
                        <span asp-validation-for = "BrandId" class = "text-danger"></span>
                    </div>

                    <div class = "col-md-12">
                        <label asp-for = "Description" class = "form-label">Mô tả sản phẩm</label>
                        <textarea asp-for = "Description" class = "form-control" rows = "6"></textarea>
                        <span asp-validation-for = "Description" class = "text-danger"></span>
                    </div>

                    <div class = "col-md-6">
                        <label class = "form-label">
                            <i class = "fa fa-image form-icon"></i> Ảnh sản phẩm mới
                        </label>
                        <input asp-for = "ImageFile" type = "file" class = "form-control" accept = "image/*"/>
                        <span asp-validation-for = "ImageFile" class = "text-danger"></span>
                        <!-- Ngay dưới input type="file" -->
                        <div class = "col-md-6">
                            <label class = "form-label">Hoặc nhập link ảnh</label>
                            <input asp-for = "ImageUrl" class = "form-control" placeholder = "https://example.com/image.jpg"/>
                            <span asp-validation-for = "ImageUrl" class = "text-danger"></span>
                            <small class = "text-secondary">Hệ thống sẽ ưu tiên dùng file upload nếu có.</small>
                        </div>

                        <small class = "text-secondary">Nếu không chọn ảnh mới thì sẽ giữ ảnh cũ.</small>
                    </div>


                    <div class = "col-md-6 d-flex align-items-end">
                        <img
                            id = "imgpreview"
                            src = "~/@Model.Image"
                            class = "img-thumbnail" alt = "Preview" style = "max-height: 150px;"
                        />
                    </div>
                </div>

                <div class = "mt-4 text-end">
                    <a asp-action = "Index" class = "btn btn-outline-secondary me-2">
                        <i class = "fas fa-arrow-left"></i> Quay lại
                    </a>
                    <button type = "submit" class = "btn btn-primary">
                        <i class = "fas fa-save"></i> Cập nhật sản phẩm
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src = "https://code.jquery.com/jquery-3.6.0.min.js"></script>
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
    <script src = "https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>

    <script>
        function readURL(input) {
            if (input.files && input.files[0]) {
                let reader = new FileReader();
                reader.onload = function (e) {
                    $('#imgpreview').attr('src', e.target.result)
                        .css({'max-width': '200px', 'max-height': '200px'});
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Nếu chọn file thì preview
        $('#ImageFile').change(function () {
            readURL(this);
        });

        // Nếu nhập link thì preview
        $('#ImageUrl').on('input', function () {
            const url = $(this).val().trim();
            if (url.length > 5 && url.startsWith("http")) {
                $('#imgpreview').attr('src', url);
            }
        });

        CKEDITOR.replace('Description');
    </script>
}

